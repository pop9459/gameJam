[gd_scene load_steps=10 format=3 uid="uid://bd5wy7ldnfyjp"]

[ext_resource type="PackedScene" uid="uid://dw7wqt3volbmq" path="res://prefabs/enemy.tscn" id="1_27ayd"]
[ext_resource type="Script" path="res://scripts/Player.cs" id="1_cwxqi"]
[ext_resource type="PackedScene" uid="uid://bwrj0ne0cb20b" path="res://prefabs/bullet.tscn" id="1_eoggm"]
[ext_resource type="Texture2D" uid="uid://c13npvcf43qlw" path="res://assets/bg.png" id="1_x23d7"]
[ext_resource type="Texture2D" uid="uid://cwyiscta484y8" path="res://assets/lilguyF.png" id="3_ud46j"]
[ext_resource type="Script" path="res://scripts/Spawner.cs" id="4_44nx5"]
[ext_resource type="Texture2D" uid="uid://cdjag6c7evevq" path="res://assets/gun.png" id="5_5labu"]
[ext_resource type="Texture2D" uid="uid://b7boduelxq2xc" path="res://assets/color.png" id="8_3j6yn"]
[ext_resource type="Texture2D" uid="uid://c64snotsy3scy" path="res://assets/colorMixed.png" id="9_7diml"]

[sub_resource type="CSharpScript" id="CSharpScript_6u41i"]
script/source = "using Godot;
using System;

public partial class EnemySpawner : Node2D
{
	[Export]
	public PackedScene EnemyScene; // Reference to the enemy scene.

	[Export]
	public Rect2 SpawnArea = new Rect2(new Vector2(-400, -400), new Vector2(800, 800)); // Spawn rectangle.

	[Export]
	public float SpawnInterval = 2f; // Time between spawns.

	private Timer _spawnTimer;

	public override void _Ready()
	{
		// Initialize and start the spawn timer.
		_spawnTimer = GetNode<Timer>(\"SpawnTimer\");
		_spawnTimer.WaitTime = SpawnInterval;
		_spawnTimer.OneShot = false;
		_spawnTimer.Connect(\"timeout\", new Callable(this, nameof(SpawnEnemy)));
		_spawnTimer.Start();
	}

	private void SpawnEnemy()
	{
		if (EnemyScene == null) return;

		// Determine a random position along the perimeter.
		Vector2 spawnPosition = GetRandomPerimeterPoint();
		var enemy = (Node2D)EnemyScene.Instantiate();
		enemy.GlobalPosition = spawnPosition;

		AddChild(enemy);
	}

	private Vector2 GetRandomPerimeterPoint()
	{
		// Get the perimeter points of the rectangle.
		float xMin = SpawnArea.Position.X; // Corrected
		float yMin = SpawnArea.Position.Y; // Corrected
		float xMax = xMin + SpawnArea.Size.X; // Corrected
		float yMax = yMin + SpawnArea.Size.Y; // Corrected

		// Randomly decide which edge to spawn on.
		int edge = (int)(GD.Randi() % 4);
		switch (edge)
		{
			case 0: // Top edge.
				return new Vector2(GD.Randf() * (xMax - xMin) + xMin, yMin);
			case 1: // Bottom edge.
				return new Vector2(GD.Randf() * (xMax - xMin) + xMin, yMax);
			case 2: // Left edge.
				return new Vector2(xMin, GD.Randf() * (yMax - yMin) + yMin);
			case 3: // Right edge.
				return new Vector2(xMax, GD.Randf() * (yMax - yMin) + yMin);
			default:
				return Vector2.Zero;
		}
	}
}
"

[node name="PlaySpace" type="Node2D"]

[node name="Camera2D" type="Camera2D" parent="."]

[node name="Room" type="Node" parent="."]

[node name="Bkg" type="Sprite2D" parent="Room"]
z_index = -10
scale = Vector2(0.4, 0.4)
texture = ExtResource("1_x23d7")

[node name="Player" type="Node2D" parent="." node_paths=PackedStringArray("redIndicator", "greenIndicator", "blueIndicator", "mixIndicator")]
script = ExtResource("1_cwxqi")
bullet = ExtResource("1_eoggm")
redIndicator = NodePath("../ColorSelector/RedIndicator")
greenIndicator = NodePath("../ColorSelector/GreenIndicator")
blueIndicator = NodePath("../ColorSelector/BlueIndicator")
mixIndicator = NodePath("../ColorSelector/MixIndicator")

[node name="Body" type="Sprite2D" parent="Player"]
scale = Vector2(0.1, 0.1)
texture = ExtResource("3_ud46j")

[node name="Gun" type="Sprite2D" parent="Player"]
position = Vector2(50, 1.90735e-06)
scale = Vector2(0.05, 0.05)
texture = ExtResource("5_5labu")

[node name="spawner" type="Node2D" parent="."]
position = Vector2(-214, -155)
script = ExtResource("4_44nx5")
enemy = ExtResource("1_27ayd")

[node name="ColorSelector" type="Node2D" parent="."]
position = Vector2(-495, -250)

[node name="RedIndicator" type="Sprite2D" parent="ColorSelector"]
self_modulate = Color(1, 0.75, 0.75, 1)
scale = Vector2(0.5, 0.5)
texture = ExtResource("8_3j6yn")

[node name="GreenIndicator" type="Sprite2D" parent="ColorSelector"]
self_modulate = Color(0.75, 1, 0.75, 1)
position = Vector2(0, 115)
scale = Vector2(0.5, 0.5)
texture = ExtResource("8_3j6yn")

[node name="BlueIndicator" type="Sprite2D" parent="ColorSelector"]
self_modulate = Color(0.75, 0.75, 1, 1)
position = Vector2(0, 230)
scale = Vector2(0.5, 0.5)
texture = ExtResource("8_3j6yn")

[node name="MixIndicator" type="Sprite2D" parent="ColorSelector"]
position = Vector2(0, 500)
scale = Vector2(0.5, 0.5)
texture = ExtResource("9_7diml")
